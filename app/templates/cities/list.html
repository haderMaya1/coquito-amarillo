{% extends "base.html" %}
{% block title %}Gestión de Ciudades{% endblock %}

{% block content %}
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Gestión de Ciudades</h2>
    <div>
      <a href="{{ url_for('cities.create_city') }}" class="btn btn-primary">
        <i class="bi bi-plus-circle"></i> Nueva Ciudad
      </a>
      <a href="{{ url_for('cities.list_cities', mostrar_inactivas=(not mostrar_inactivas)) }}"
        class="btn btn-{% if mostrar_inactivas %}warning{% else %}secondary{% endif %}">
        <i class="bi {% if mostrar_inactivos %}bi-eye-slash{% else %}bi-eye{% endif %}"></i>
        {% if mostrar_inactivas %}Ocultar Inactivas{% else %}Mostrar Inactivas{% endif %}
      </a>
    </div>
  </div>

  <div class="card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped align-middle">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {% for ciudad in ciudades %}
            <tr class="{% if not ciudad.activo %}table-secondary{% endif %}">
              <td>{{ ciudad.id_ciudad }}</td>
              <td>{{ ciudad.nombre }}</td>
              <td>
                <a href="{{ url_for('cities.list_cities', mostrar_inactivos=not mostrar_inactivos)}}"
                  class="badge {% if ciudad.activo %}bg-success{% else %}bg-secondary{% endif %}">
                  {% if ciudad.activo %} Activa {% else %} Inactiva {% endif %}
                  </span>
                </a>
              </td>
              <td>
                <a href="{{ url_for('cities.view_city', city_id=ciudad.id_ciudad) }}" class="btn btn-sm btn-info">
                  <i class="bi bi-eye"></i> Ver
                </a>
                <a href="{{ url_for('cities.edit_city', city_id=ciudad.id_ciudad) }}" class="btn btn-sm btn-warning">
                  <i class="bi bi-pencil"></i> Editar
                </a>

                {% if ciudad.activo %}
                <form method="POST" action="{{ url_for('cities.permanent_delete_city', city_id=ciudad.id_ciudad) }}"
                  class="d-inline">
                  {{ form.hidden_tag() }}
                  <button type="submit" class="btn btn-sm btn-danger"
                    onclick="return confirm('⚠️ Esta acción eliminará al Proveedor de forma permanente. ¿Continuar?')">
                    <i class="bi bi-trash-fill"></i> Delete
                  </button>
                </form>
                <!-- Formulario WTForms para desactivar -->
                <form method="POST" action="{{ url_for('cities.delete_city', city_id=ciudad.id_ciudad) }}"
                  class="d-inline">
                  {{ form.hidden_tag() }}
                  <button type="submit" class="btn btn-sm btn-danger"
                    onclick="return confirm('¿Desactivar esta ciudad?')">
                    <i class="bi bi-x-circle"></i> Desactivar
                  </button>
                </form>
                {% else %}
                <!-- Formulario WTForms para activar -->
                <form method="POST" action="{{ url_for('cities.activate_city', city_id=ciudad.id_ciudad) }}"
                  class="d-inline">
                  {{ form.hidden_tag() }}
                  <button type="submit" class="btn btn-sm btn-success"
                    onclick="return confirm('¿Reactivar esta ciudad?')">
                    <i class="bi bi-check-circle"></i> Activar
                  </button>
                </form>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}