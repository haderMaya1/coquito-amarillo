{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="container mt-4 text-black">
    <h2 class="mb-4">
        <i class="bi bi-speedometer2"></i>
        Bienvenido {{ current_user.nombre }} ({{ current_user.rol.nombre }})
    </h2>

    <!-- ================= ADMINISTRADOR ================= -->
    {% if current_user.rol.nombre == "Administrador" %}
    <div class="row g-4 text-black">
        <div class="col-md-2">
            <div class="card text-center bg-primary text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Productos</h5>
                    <p class="display-6">{{ stats.total_products }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-success text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Ventas Hoy</h5>
                    <p class="display-6">{{ stats.total_sales_today }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-info text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Clientes</h5>
                    <p class="display-6">{{ stats.total_clients }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-warning text-dark shadow-sm border-0">
                <div class="card-body">
                    <h5>Tiendas</h5>
                    <p class="display-6">{{ stats.total_stores }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-secondary text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Empleados</h5>
                    <p class="display-6">{{ stats.total_staff }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center bg-dark text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Proveedores</h5>
                    <p class="display-6">{{ stats.total_suppliers }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ventas recientes -->
    <h4 class="mt-5"><i class="bi bi-receipt"></i> Ventas recientes</h4>
    <div class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>ID Venta</th>
                    <th>Cliente</th>
                    <th>Total</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody>
                {% for venta in stats.recent_sales %}
                <tr>
                    <td>#{{ venta.id_venta }}</td>
                    <td>{{ venta.cliente.nombre }}</td>
                    <td>${{ "%.2f"|format(venta.total) }}</td>
                    <td>{{ venta.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                </tr>
                {% else %}
                <tr><td colspan="4" class="text-center">No hay ventas recientes</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Productos con bajo stock -->
    <h4 class="mt-5"><i class="bi bi-exclamation-triangle"></i> Productos con bajo stock</h4>
    <div class="table-responsive">
        <table class="table table-hover align-middle">
            <thead>
                <tr>
                    <th>ID</th><th>Nombre</th><th>Stock</th>
                </tr>
            </thead>
            <tbody>
                {% for product in stats.low_stock_products %}
                <tr class="table-warning">
                    <td>{{ product.id_producto }}</td>
                    <td>{{ product.nombre }}</td>
                    <td>{{ product.stock }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-center">Todos los productos tienen stock suficiente</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- ================= VENDEDOR ================= -->
    {% if current_user.rol.nombre == "Vendedor" %}
    <div class="row g-4 text-black">
        <div class="col-md-4">
            <div class="card text-center bg-success text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Ventas Hoy en mi Tienda</h5>
                    <p class="display-6">{{ stats.store_sales_today }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-center bg-info text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Clientes en mi Tienda</h5>
                    <p class="display-6">{{ stats.total_clients }}</p>
                </div>
            </div>
        </div>
    </div>

    <h4 class="mt-5"><i class="bi bi-receipt"></i> Ventas recientes en mi Tienda</h4>
    <div class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr>
                    <th>ID Venta</th><th>Cliente</th><th>Total</th><th>Fecha</th>
                </tr>
            </thead>
            <tbody>
                {% for venta in stats.store_recent_sales %}
                <tr>
                    <td>#{{ venta.id_venta }}</td>
                    <td>{{ venta.cliente.nombre }}</td>
                    <td>${{ "%.2f"|format(venta.total) }}</td>
                    <td>{{ venta.fecha.strftime('%d/%m/%Y %H:%M') }}</td>
                </tr>
                {% else %}
                <tr><td colspan="4" class="text-center">No hay ventas recientes en tu tienda</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- ================= PROVEEDOR ================= -->
    {% if current_user.rol.nombre == "Proveedor" %}
    <div class="row g-4">
        <div class="col-md-6">
            <div class="card text-center bg-primary text-white shadow-sm border-0">
                <div class="card-body">
                    <h5>Órdenes como Proveedor</h5>
                    <p class="display-6">{{ stats.supplier_orders|length if stats.supplier_orders else 0 }}</p>
                </div>
            </div>
        </div>
    </div>

    <h4 class="mt-5"><i class="bi bi-box-seam"></i> Órdenes recientes</h4>
    <div class="table-responsive">
        <table class="table table-striped align-middle">
            <thead>
                <tr><th>ID Orden</th><th>Fecha</th><th>Estado</th></tr>
            </thead>
            <tbody>
                {% for orden in stats.recent_orders %}
                <tr>
                    <td>#{{ orden.id_orden_proveedor }}</td>
                    <td>{{ orden.fecha_creacion.strftime('%d/%m/%Y %H:%M') }}</td>
                    <td>{{ orden.estado }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3" class="text-center">No hay órdenes recientes</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
</div>
{% endblock %}